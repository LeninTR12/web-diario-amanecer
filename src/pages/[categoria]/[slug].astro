---
import { articlesHandler } from "@/lib/handlers/articles";
import { categoriesHandler } from "@/lib/handlers/categories";
import type { Article, ArticleMeta, Category } from "@/lib/types";
import BaseLayout from "@/layouts/base.astro";
import ContentLayout from "@/layouts/content.astro";
import ArticleHeader from "../articles/_components/article-header.astro";
import CustomAds from "src/components/widgets/CustomAds.astro";
import { scopesHandler } from "@/lib/handlers/scopes";
import Content from "../articles/_components/article-content.astro";
import { SITE } from "@/lib/config";
import { decode } from "html-entities";
import PrintEdition from "@/components/widgets/printEdition.astro";
import RecentNews from "../_home/recentNews.astro";

const { categoria, slug } = Astro.params;

const categoryXcat: Category = await categoriesHandler.oneCategoryBySlug(categoria as string);
const categoryXScope = await scopesHandler.oneScopeSlug(categoria as string);

const category = categoryXcat || categoryXScope;
if (!category) return Astro.redirect("/404");

const article:Article = await articlesHandler.oneArticleBySlug(slug as string);

if (!article) return Astro.redirect("/404");

const meta: ArticleMeta = {
  title: `${decode(String (article.title.rendered))} - ${SITE.title}`,
  metaTitle: decode(String (article.title.rendered)),
  description: decode(String(article.excerpt.rendered)),
  type: "article",
  ogImage: article._embedded["wp:featuredmedia"]?.[0]["source_url"],
  ogImageAlt:decode(String (article.title.rendered)),
  publishedTime: article.date,
  lastModified: article.modified,
};

---

<BaseLayout meta={meta}>
  <CustomAds/>
  <ArticleHeader article={article} />
  <ContentLayout>
      <Content article = {article} />
    </ContentLayout>
        
</BaseLayout>
